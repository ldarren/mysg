{
    "deps":{
        "util":"api/util",
		"fb":"api/fb",
		"common":"api/common",
		"addTrip":"api/addTrip",
		"trip":"api/trip",
        "web":["context","webServer"]
    },      
    "routes":{
        "/mysg":[
            ["util","route","req"],
			["web","parse","req","res"]
        ],
        "/mysg/fb/webhook":[
            ["fb","$route","req"],
			["web","getBody","req","body"],
			["fb","parse","body"],
			[]
        ],
		"fb/validate":[
			["fb","verify","query"],
			[]
		],
		"fb/lostAt":[
			["fb","prepare",["user",":action","name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/addUser":[
			["fb","prepare",["user",":action"]],
			["fb","getUser","user"],
			["common","nextStep","user",":action",["Role"]]
		],
		"fb/askRole|#prefix":[
			["fb","prepare",["user"]],
			["common","askRole","user","msg"],
			["fb","send","msg"]
		],
		"fb/addRole":[
			["fb","prepare",["user",":action","evt"]],
			["common","addRole","user",":action","evt"],
			["common","nextStep","user",":action",["Action"]]
		],
		"fb/askAction|#prefix":[
			["fb","prepare",["user"]],
			["common","askAction","user","msg"],
			["fb","send","msg"]
		],
		"fb/addAction":[
			["fb","prepare",["user",":action","evt"]],
			["common","$addAction","user",":action","evt",["name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/askTripDate|#prefix":[
			["fb","prepare",["user"]],
			["addTrip","askDate","user","msg"],
			["fb","send","msg"]
		],
		"fb/addTripDate":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addDate","user",":action","evt"],
			["common","nextStep","user",":action",["TripTime"]]
		],
		"fb/askTripTime|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls key in the pick up time in '9:35pm' format"]],
			["fb","send","msg"]
		],
		"fb/addTripTime":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addTime","user",":action","evt"],
			["common","nextStep","user",":action",["TripFirstPickup"]]
		],
		"fb/askTripFirstPickup|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add a pick up location"]],
			["fb","send","msg"]
		],
		"fb/addTripFirstPickup":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addPickup","user",":action","evt",["name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/askTripPickup|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add another pick up location, or type 'done' to proceed"]],
			["fb","send","msg"]
		],
		"fb/addTripPickup":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addPickup","user",":action","evt",["name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/askTripFirstDropoff|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add a drop off location"]],
			["fb","send","msg"]
		],
		"fb/addTripFirstDropoff":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addDropoff","user",":action","evt",["name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/askTripDropoff|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add another drop off location, or type 'done' to proceed"]],
			["fb","send","msg"]
		],
		"fb/addTripDropoff":[
			["fb","prepare",["user",":action","evt"]],
			["addTrip","addDropoff","user",":action","evt",["name"]],
			["common","nextStep","user",":action","name"]
		],
		"fb/askTripSeat|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls specify available seats, e.g. 10"]],
			["fb","send","msg"]
		],
		"fb/addTripSeat":[
			["fb","prepare",["user",":action","evt"]],
			["common","readTextInputTo",":action","evt",["+$seat","ASK DRIVER"]],
			["common","nextStep","user",":action",["TripPrice"]]
		],
		"fb/askTripPrice|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add price per pax, e.g. SGD10 pax"]],
			["fb","send","msg"]
		],
		"fb/addTripPrice":[
			["fb","prepare",["user",":action","evt"]],
			["common","readTextInputTo",":action","evt",["+$price","ASK DRIVER"]],
			["common","nextStep","user",":action",["TripContact"]]
		],
		"fb/askTripContact|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls leave your phone number"]],
			["fb","send","msg"]
		],
		"fb/addTripContact":[
			["fb","prepare",["user",":action","evt"]],
			["common","readTextInputTo",":action","evt",["+$contact","NA"]],
			["common","nextStep","user",":action",["TripNote"]]
		],
		"fb/askTripNote|#prefix":[
			["fb","prepare",["user"]],
			["common","createMsg","user","msg",["Pls add an optional remark"]],
			["fb","send","msg"]
		],
		"fb/addTripNote":[
			["fb","prepare",["user",":action","evt"]],
			["common","readTextInputTo",":action","evt",["+$note","NA"]],
			["common","finalStep","user",":action"]
		],
		"fb/compileAction":[
			["fb","prepare",["user",":action"]],
			["common","$compileAction","user",":action","cmd"]
		],
		"fb/addTrip":[
			["addTrip","done","user","cmd","msg"],
			["fb","send","msg"]
		],
		"fb/myTrip":[
			["trip","myTrip","user","cmd","msg"],
			["fb","send","msg"]
		],
		"fb/myRide":[
			["trip","myRide","user","cmd","msg"],
			["fb","send","msg"]
		],
		"fb/trip/cancel":[
		],
		"fb/trip/cancel/confirm":[
		],
        "ERR|#msg": [
            []
        ],
        "END|#msg": [
            [] 
        ],
        "#help": [
            ["util","help"] 
        ] 
    }
}   
